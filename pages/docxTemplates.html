<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<div id="docxTemplates_PageContainer" style="width:100%;height:100%;">
    <div id="docxTemplates_ContentPaneDetailContainer" style="width:100%;height:100%; margin:0;padding:0;">
        <table id="docxTemplatesParameters" class="docxTemplateParameters" width="100%">
            <tr>
                <th height="30px"><b>Название параметра:</b></th><th height="30px"><b>Значение параметра:</b></th>
            </tr>
        </table>
    </div>
    <div id="docxTemplates_ContentPaneParamsHistory" style="width:100%;height:200px; margin:0;padding:0;">
        <div id="docxTemplates_TableParamsHistoryHeader" style="width:100%;height:auto; margin:0;padding:0;">
            <table width="100%" height="100%" class="docxTemplateParameters" style="margin:0;padding:0;">
                <tr height="25px"><th>Сохраненные параметры</th></tr>
            </table>
        </div>
        <div id="docxTemplates_TableParamsHistory" style="margin:0;padding:0"></div>
    </div>
</div>
</body>
<script type="text/javascript">
    require(["app/app", "dojo/dom-style", "dijit/layout/BorderContainer", "dijit/layout/LayoutContainer", "dijit/layout/ContentPane",
                "dijit/form/Button", "dijit/form/TextBox", "app/request", "app/dialogs", "app/hTableSimpleFiltered"],
            function (APP, domStyle, BorderContainer, LayoutContainer, ContentPane, Button, TextBox, Request, Dialogs, HTable) {
                var pageContainer= APP.instanceForID("docxTemplates_PageContainer", BorderContainer, {});
                var contentPaneDetail= APP.instanceForID("docxTemplates_ContentPaneDetailContainer", ContentPane, {region:'center'});
                var contentPaneParamsHistory= APP.instanceForID("docxTemplates_ContentPaneParamsHistory", LayoutContainer, {region:'bottom', splitter:true});
                APP.instanceForID("docxTemplates_TableParamsHistoryHeader", ContentPane, {region:'top'});
                contentPaneParamsHistory.hTableParamsHistory=
                        new HTable({region:'center', wordWrap:true, readOnly:true, useFilters:true, allowFillHandle:false},
                                "docxTemplates_TableParamsHistory");
                contentPaneParamsHistory.loadParamsHistory= function(){
                    contentPaneParamsHistory.hTableParamsHistory.setContentFromUrl({url:"/docxTemplates/"+pageID+"/getTemplateParamsHistory",condition:null});
                };

                var pageID="docxTemplates_";
                contentPaneDetail.textBoxes={};
                contentPaneDetail.setTemplateContent = function(){
                    Request.getJSONData({url:"/docxTemplates/"+pageID+"/getTemplateData", consoleLog:true},
                            function(result){                                                       console.log(pageID+".getTemplateData result=",result);
                                if(result===undefined||result==null) result = [];
                                if(!result.fields) return;
                                var tr,td,div, label,input,textBox, button;
                                var table= contentPaneDetail.domNode.getElementsByTagName("table")[0];
                                for(var tID in result.fields){
                                    var tTitle=result.fields[tID];
                                    table.appendChild(tr=document.createElement("tr"));
                                    tr.appendChild(td=document.createElement("td"));
                                    td.appendChild(div=document.createElement("div"));td.setAttribute("style","text-align:right");
                                    div.appendChild(label=document.createElement("label"));
                                    label.setAttribute("for",pageID+tID);label.innerHTML=tTitle;
                                    tr.appendChild(td=document.createElement("td"));
                                    td.appendChild(div=document.createElement("div"));
                                    div.appendChild(input=document.createElement("input"));
                                    input.setAttribute("id",pageID+tID);
                                    textBox=new TextBox({id:pageID+tID,style:"width:450px;"},pageID+tID);
                                    contentPaneDetail.textBoxes[tID]=textBox;
                                }
                                table.appendChild(tr=document.createElement("tr"));
                                tr.appendChild(document.createElement("td"));
                                tr.appendChild(td=document.createElement("td"));
                                td.appendChild(div=document.createElement("div"));
                                div.appendChild(button=document.createElement("button"));
                                button.setAttribute("id",pageID+"btnSendDataAndGenDocx");button.innerText="Сгенерировать документ";
                                button=new Button({id:pageID+"btnSendDataAndGenDocx",style:"width:300px;"},pageID+"btnSendDataAndGenDocx");
                                button.onClick=function(){
                                    var sendingData={};
                                    for(var tID in contentPaneDetail.textBoxes){
                                        sendingData[tID]=contentPaneDetail.textBoxes[tID].get("value");
                                    }
                                    Request.postJSONData({url:"/docxTemplates/"+pageID+"/sendDataAndGenDocx", data:sendingData, consoleLog:true},
                                            function(result){
                                                if(result.result){
                                                    var userMsg=result.userMsg;
                                                    if(!userMsg) userMsg="НЕИЗВЕСТНО.";
                                                    Dialogs.doRequestFailDialog({title:"Результат операции",content:userMsg});
                                                } else {
                                                    Dialogs.doRequestFailDialog({title:"Внимание",content:"Не удалось получить результат операции с сервера!"});
                                                }
                                            });
                                    };
                                    contentPaneParamsHistory.loadParamsHistory();
                            });
                };
                contentPaneDetail.setTemplateContent();
//                var btnProdsRems= APP.instanceForID("docxTemplates_btnProdsRems", Button, {},{"width":"150px"});
//                var btnProdsMoves= APP.instanceForID("docxTemplates_btnProdsMoves", Button, {},{"width":"150px"});
//                var contentPaneDetailContainer= APP.instanceForID("docxTemplates_ContentPaneDetailContainer", StackContainer, {region:'center'});
//                btnProdsRems.onClick= function(){
//                    if (!btnProdsRems.report){
//                        btnProdsRems.report = APP.childFor(contentPaneDetailContainer, "docxTemplates_tableProdsRems",
//                                TDocSimpleTable, {titleText:"Текущие остатки товаров", dataURL:"/reports/prodsRems/getProductsRems",
//                                    buttonPrint:false, buttonExportToExcel:false})
//                                .addSelectBox("Склад",{valueItemName:"StockID", labelItemName:"StockName",
//                                    loadDropDownURL:"/reports/cashier/getDirStocksForSelect",
//                                    contentTableCondition:"StockID="/*, width:300*/})
//                                .addCheckBtnCondition("Не нулевые",{width:90,contentTableConditions:{"SUM(Qty)<>":"0"}})
//                                .addCheckBtnCondition("Все",{width:85})
//                                .addCheckBtnCondition("Нулевые",{width:70,contentTableConditions:{"SUM(Qty)~":"0"}})
//                                .addTotalCountNumberBox("ИТОГО строк:", 140)
//                                .addTotalSumNumberTextBox("ИТОГО остаток:", 1160, "TQty", {style:"font-weight:bold;"})
//                                .startUp();
//                    }
//                    contentPaneDetailContainer.selectChild(btnProdsRems.report);
//                };
                pageContainer.layout();
        });
</script>
</html>